"use strict";App.Pages.CustomFields=function(){function bindEventHandlers(){$customFields.on("submit","#filter-custom-fields form",function(event){event.preventDefault();var key=$("#filter-custom-fields .key").val();$("#filter-custom-fields .selected").removeClass("selected"),filter(key)}),$customFields.on("click",".custom-field-row",function(){$("#edit-custom-field").prop("disabled")&&($("#edit-custom-field").prop("disabled",!1),$("#delete-custom-field").prop("disabled",!1));var $this=$(this),customFieldId=$this.attr("data-id"),customField=filterResults.find(function(filterResult){return+filterResult.id===+customFieldId});display(customField),$(".selected").removeClass("selected"),$this.addClass("selected")}),$("#add-custom-field").on("click",function(){resetForm(),$customFields.find(".add-edit-delete-group").hide(),$customFields.find(".save-cancel-group").show(),$customFields.find(".record-details").find("input, select, textarea").prop("disabled",!1),$("#name").trigger("focus")}),$("#edit-custom-field").on("click",function(){$customFields.find(".add-edit-delete-group").hide(),$customFields.find(".save-cancel-group").show(),$customFields.find(".record-details").find("input, select, textarea").prop("disabled",!1),$("#name").trigger("focus")}),$("#delete-custom-field").on("click",function(){var customFieldId=$id.val(),buttons=[{text:lang("cancel"),click:function click(event,messageModal){messageModal.hide()}},{text:lang("delete"),click:function click(event,messageModal){remove(customFieldId),messageModal.hide()}}];App.Utils.Message.show(lang("delete_custom_field"),lang("delete_record_prompt"),buttons)}),$("#save-custom-field").on("click",function(){save()}),$("#cancel-custom-field").on("click",function(){var id=$id.val();resetForm(),id&&select(id,!0)}),$type.on("change",function(){var type=$(this).val();"select"===type?$optionsSection.show():$optionsSection.hide()}),$("#add-option").on("click",function(){addOptionRow()}),$optionsList.on("click",".delete-option",function(){$(this).closest(".option-row").remove()})}function addOptionRow(option){var optionId=option?option.id:"",optionValue=option?option.option_value:"",optionLabel=option?option.option_label:"",$row=$("<div class=\"option-row input-group mb-2\">").append("<input type=\"hidden\" class=\"option-id\" value=\"".concat(optionId,"\">")).append("<input type=\"text\" class=\"form-control option-value\" placeholder=\"".concat(lang("value"),"\" value=\"").concat(optionValue,"\">")).append("<input type=\"text\" class=\"form-control option-label\" placeholder=\"".concat(lang("label"),"\" value=\"").concat(optionLabel,"\">")).append("<button type=\"button\" class=\"btn btn-outline-danger delete-option\"><i class=\"fas fa-trash\"></i></button>");$optionsList.append($row)}function save(){var customField={name:$name.val(),label:$label.val(),type:$type.val(),required:$required.prop("checked")?1:0,display_column:$displayColumn.prop("checked")?1:0,active:$active.prop("checked")?1:0};$id.val()&&(customField.id=$id.val()),validate()&&App.Http.CustomFields.save(customField).then(function(response){App.Layouts.Backend.displayNotification(lang("custom_field_saved")),resetForm(),$("#filter-custom-fields .key").val(""),filter("",response.id)})}function remove(id){App.Http.CustomFields["delete"](id).then(function(){App.Layouts.Backend.displayNotification(lang("custom_field_deleted")),resetForm(),filter($("#filter-custom-fields .key").val())})}function validate(){$customFields.find(".is-invalid").removeClass("is-invalid"),$customFields.find(".form-message").hide();try{var customField={name:$name.val(),label:$label.val(),type:$type.val()};if(!customField.name||!customField.label||!customField.type)throw new Error(lang("fields_are_required"));return!0}catch(error){return $customFields.find(".form-message").addClass("alert-danger").text(error.message).show(),!1}}function resetForm(){$customFields.find(".add-edit-delete-group").show(),$customFields.find(".save-cancel-group").hide(),$customFields.find(".record-details").find("input, select, textarea").val("").prop("disabled",!0),$customFields.find(".record-details .form-message").hide(),$customFields.find(".record-details h3 a").remove(),$("#edit-custom-field").prop("disabled",!0),$("#delete-custom-field").prop("disabled",!0),$customFields.find(".selected").removeClass("selected"),$customFields.find(".record-details .is-invalid").removeClass("is-invalid"),$optionsSection.hide(),$optionsList.empty()}function display(customField){$id.val(customField.id),$name.val(customField.name),$label.val(customField.label),$type.val(customField.type),$required.prop("checked",!!customField.required),$displayColumn.prop("checked",!!customField.display_column),$active.prop("checked",!!customField.active),"select"===customField.type?($optionsSection.show(),$optionsList.empty(),App.Http.CustomFields.getOptions(customField.id).then(function(options){options.forEach(function(option){addOptionRow(option)})})):$optionsSection.hide()}function filter(keyword){var selectId=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,show=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];App.Http.CustomFields.search(keyword,20).then(function(response){filterResults=response,$("#filter-custom-fields .results").empty(),response.forEach(function(customField){$("#filter-custom-fields .results").append(getFilterHtml(customField)).append($("<hr/>"))}),response.length||$("#filter-custom-fields .results").append($("<em/>",{text:lang("no_records_found")})),selectId&&select(selectId,show)})}function getFilterHtml(customField){var activeIcon=customField.active?"fa-check":"";return $("<div/>",{class:"custom-field-row entry","data-id":customField.id,html:[$("<strong/>",{text:customField.label}),$("<br/>"),$("<span/>",{class:"text-muted",text:customField.name}),$("<i/>",{class:"fas ".concat(activeIcon," ms-2")})]})}function select(id,show){if($("#filter-custom-fields .selected").removeClass("selected"),$("#filter-custom-fields .custom-field-row[data-id=\""+id+"\"]").addClass("selected"),show){var customField=filterResults.find(function(filterResult){return+filterResult.id===+id});display(customField)}}var $customFields=$("#custom-fields"),$id=$("#id"),$name=$("#name"),$label=$("#label"),$type=$("#type"),$required=$("#required"),$displayColumn=$("#display_column"),$active=$("#active"),$filterCustomFields=$("#filter-custom-fields"),$optionsSection=$("#options-section"),$optionsList=$("#options-list"),filterResults={};return document.addEventListener("DOMContentLoaded",function(){resetForm(),filter(""),bindEventHandlers()}),{filter:filter,save:save,delete:remove,getFilterHtml:getFilterHtml}}();